

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Planning Scene &mdash; moveit2_tutorials Foxy documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../_static/override.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="moveit2_tutorials Foxy documentation" href="../../index.html"/>
        <link rel="next" title="Planning Scene Monitor" href="../planning_scene_monitor/planning_scene_monitor_tutorial.html"/>
        <link rel="prev" title="Robot Model and Robot State" href="../robot_model_and_robot_state/robot_model_and_robot_state_tutorial.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-108532843-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-108532843-1');
  </script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        <a href="http://moveit.ros.org">
          <img src="../../_static/logo.png"/>
        </a>

        <div class="version">
    <div class="version-dropdown">
        <lable for="version-list">Version:</lable>
    <select class="version-list" id="version-list" onchange="this.options[this.selectedIndex].value && (window.location = this.options[this.selectedIndex].value);">
        <option value=''>MoveIt 2 - Foxy</option>
        <option value="http://ros-planning.github.io/moveit_tutorials/">MoveIt 1 - Noetic</option>
        <option value="http://docs.ros.org/en/melodic/api/moveit_tutorials/html/index.html">MoveIt 1 - Melodic</option>
    </select>
    </div>
</div><br>
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search tutorials" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/getting_started.html">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/getting_started.html#install-ros-2-and-colcon">Install ROS 2 and Colcon</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/getting_started.html#create-a-colcon-workspace-and-download-tutorials">Create A Colcon Workspace and Download Tutorials</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/getting_started.html#download-moveit-2-tutorials-source">Download MoveIt 2 Tutorials Source</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/getting_started.html#build-your-colcon-workspace">Build your Colcon Workspace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/getting_started.html#next-step">Next Step</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart_in_rviz/quickstart_in_rviz_tutorial.html">MoveIt Quickstart in RViz</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../quickstart_in_rviz/quickstart_in_rviz_tutorial.html#getting-started">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart_in_rviz/quickstart_in_rviz_tutorial.html#step-1-launch-the-demo-and-configure-the-plugin">Step 1: Launch the Demo and Configure the Plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart_in_rviz/quickstart_in_rviz_tutorial.html#step-2-play-with-the-visualized-robots">Step 2: Play with the Visualized Robots</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart_in_rviz/quickstart_in_rviz_tutorial.html#step-3-interact-with-the-panda">Step 3: Interact with the Panda</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../quickstart_in_rviz/quickstart_in_rviz_tutorial.html#moving-into-collision">Moving into collision</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quickstart_in_rviz/quickstart_in_rviz_tutorial.html#moving-out-of-reachable-workspace">Moving out of Reachable Workspace</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quickstart_in_rviz/quickstart_in_rviz_tutorial.html#moving-joints-or-in-null-space">Moving Joints or in Null Space</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart_in_rviz/quickstart_in_rviz_tutorial.html#step-4-use-motion-planning-with-the-panda">Step 4: Use Motion Planning with the Panda</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../quickstart_in_rviz/quickstart_in_rviz_tutorial.html#introspecting-trajectory-waypoints">Introspecting Trajectory Waypoints</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quickstart_in_rviz/quickstart_in_rviz_tutorial.html#plan-cartesian-motions">Plan Cartesian motions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quickstart_in_rviz/quickstart_in_rviz_tutorial.html#executing-trajectories-adjusting-speed">Executing Trajectories, Adjusting Speed</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../quickstart_in_rviz/quickstart_in_rviz_tutorial.html#next-steps">Next Steps</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../quickstart_in_rviz/quickstart_in_rviz_tutorial.html#rviz-visual-tools">RViz Visual Tools</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quickstart_in_rviz/quickstart_in_rviz_tutorial.html#saving-your-configuration">Saving Your Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../quickstart_in_rviz/quickstart_in_rviz_tutorial.html#next-tutorials">Next Tutorials</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../move_group_interface/move_group_interface_tutorial.html">Move Group C++ Interface</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../move_group_interface/move_group_interface_tutorial.html#getting-started">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../move_group_interface/move_group_interface_tutorial.html#running-the-code">Running the Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../move_group_interface/move_group_interface_tutorial.html#expected-output">Expected Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="../move_group_interface/move_group_interface_tutorial.html#the-entire-code">The Entire Code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../move_group_interface/move_group_interface_tutorial.html#setup">Setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="../move_group_interface/move_group_interface_tutorial.html#visualization">Visualization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../move_group_interface/move_group_interface_tutorial.html#getting-basic-information">Getting Basic Information</a></li>
<li class="toctree-l3"><a class="reference internal" href="../move_group_interface/move_group_interface_tutorial.html#start-the-demo">Start the demo</a></li>
<li class="toctree-l3"><a class="reference internal" href="../move_group_interface/move_group_interface_tutorial.html#planning-to-a-pose-goal">Planning to a Pose goal</a></li>
<li class="toctree-l3"><a class="reference internal" href="../move_group_interface/move_group_interface_tutorial.html#visualizing-plans">Visualizing plans</a></li>
<li class="toctree-l3"><a class="reference internal" href="../move_group_interface/move_group_interface_tutorial.html#moving-to-a-pose-goal">Moving to a pose goal</a></li>
<li class="toctree-l3"><a class="reference internal" href="../move_group_interface/move_group_interface_tutorial.html#planning-to-a-joint-space-goal">Planning to a joint-space goal</a></li>
<li class="toctree-l3"><a class="reference internal" href="../move_group_interface/move_group_interface_tutorial.html#planning-with-path-constraints">Planning with Path Constraints</a></li>
<li class="toctree-l3"><a class="reference internal" href="../move_group_interface/move_group_interface_tutorial.html#enforce-planning-in-joint-space">Enforce Planning in Joint Space</a></li>
<li class="toctree-l3"><a class="reference internal" href="../move_group_interface/move_group_interface_tutorial.html#cartesian-paths">Cartesian Paths</a></li>
<li class="toctree-l3"><a class="reference internal" href="../move_group_interface/move_group_interface_tutorial.html#adding-objects-to-the-environment">Adding objects to the environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../move_group_interface/move_group_interface_tutorial.html#attaching-objects-to-the-robot">Attaching objects to the robot</a></li>
<li class="toctree-l3"><a class="reference internal" href="../move_group_interface/move_group_interface_tutorial.html#detaching-and-removing-objects">Detaching and Removing Objects</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../move_group_interface/move_group_interface_tutorial.html#the-launch-file">The Launch File</a></li>
<li class="toctree-l2"><a class="reference internal" href="../move_group_interface/move_group_interface_tutorial.html#a-note-on-setting-tolerances">A Note on Setting Tolerances</a></li>
</ul>
</li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../robot_model_and_robot_state/robot_model_and_robot_state_tutorial.html">Robot Model and Robot State</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../robot_model_and_robot_state/robot_model_and_robot_state_tutorial.html#the-robotmodel-and-robotstate-classes">The RobotModel and RobotState Classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../robot_model_and_robot_state/robot_model_and_robot_state_tutorial.html#getting-started">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../robot_model_and_robot_state/robot_model_and_robot_state_tutorial.html#running-the-code">Running the Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../robot_model_and_robot_state/robot_model_and_robot_state_tutorial.html#expected-output">Expected Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="../robot_model_and_robot_state/robot_model_and_robot_state_tutorial.html#the-entire-code">The Entire Code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../robot_model_and_robot_state/robot_model_and_robot_state_tutorial.html#start">Start</a></li>
<li class="toctree-l3"><a class="reference internal" href="../robot_model_and_robot_state/robot_model_and_robot_state_tutorial.html#get-joint-values">Get Joint Values</a></li>
<li class="toctree-l3"><a class="reference internal" href="../robot_model_and_robot_state/robot_model_and_robot_state_tutorial.html#joint-limits">Joint Limits</a></li>
<li class="toctree-l3"><a class="reference internal" href="../robot_model_and_robot_state/robot_model_and_robot_state_tutorial.html#forward-kinematics">Forward Kinematics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../robot_model_and_robot_state/robot_model_and_robot_state_tutorial.html#inverse-kinematics">Inverse Kinematics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../robot_model_and_robot_state/robot_model_and_robot_state_tutorial.html#get-the-jacobian">Get the Jacobian</a></li>
<li class="toctree-l3"><a class="reference internal" href="../robot_model_and_robot_state/robot_model_and_robot_state_tutorial.html#the-launch-file">The Launch File</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Planning Scene</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#getting-started">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-entire-code">The entire code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#setup">Setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="#collision-checking">Collision Checking</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#self-collision-checking">Self-collision checking</a></li>
<li class="toctree-l4"><a class="reference internal" href="#change-the-state">Change the state</a></li>
<li class="toctree-l4"><a class="reference internal" href="#checking-for-a-group">Checking for a group</a></li>
<li class="toctree-l4"><a class="reference internal" href="#getting-contact-information">Getting Contact Information</a></li>
<li class="toctree-l4"><a class="reference internal" href="#modifying-the-allowed-collision-matrix">Modifying the Allowed Collision Matrix</a></li>
<li class="toctree-l4"><a class="reference internal" href="#full-collision-checking">Full Collision Checking</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#constraint-checking">Constraint Checking</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#checking-kinematic-constraints">Checking Kinematic Constraints</a></li>
<li class="toctree-l4"><a class="reference internal" href="#user-defined-constraints">User-defined constraints</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#the-launch-file">The launch file</a></li>
<li class="toctree-l2"><a class="reference internal" href="#running-the-code">Running the code</a></li>
<li class="toctree-l2"><a class="reference internal" href="#expected-output">Expected Output</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../planning_scene_monitor/planning_scene_monitor_tutorial.html">Planning Scene Monitor</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../planning_scene_monitor/planning_scene_monitor_tutorial.html#robotstate">RobotState</a></li>
<li class="toctree-l2"><a class="reference internal" href="../planning_scene_monitor/planning_scene_monitor_tutorial.html#currentstatemonitor">CurrentStateMonitor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../planning_scene_monitor/planning_scene_monitor_tutorial.html#planningscene">PlanningScene</a></li>
<li class="toctree-l2"><a class="reference internal" href="../planning_scene_monitor/planning_scene_monitor_tutorial.html#planningscenemonitor">PlanningSceneMonitor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../planning_scene_monitor/planning_scene_monitor_tutorial.html#planningsceneinterface">PlanningSceneInterface</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../planning_scene_ros_api/planning_scene_ros_api_tutorial.html">Planning Scene ROS API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../planning_scene_ros_api/planning_scene_ros_api_tutorial.html#getting-started">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../planning_scene_ros_api/planning_scene_ros_api_tutorial.html#running-the-code">Running the code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../planning_scene_ros_api/planning_scene_ros_api_tutorial.html#expected-output">Expected Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="../planning_scene_ros_api/planning_scene_ros_api_tutorial.html#the-entire-code">The entire code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../planning_scene_ros_api/planning_scene_ros_api_tutorial.html#visualization">Visualization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../planning_scene_ros_api/planning_scene_ros_api_tutorial.html#ros-api">ROS API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../planning_scene_ros_api/planning_scene_ros_api_tutorial.html#advertise-the-required-topic">Advertise the required topic</a></li>
<li class="toctree-l3"><a class="reference internal" href="../planning_scene_ros_api/planning_scene_ros_api_tutorial.html#define-the-attached-object-message">Define the attached object message</a></li>
<li class="toctree-l3"><a class="reference internal" href="../planning_scene_ros_api/planning_scene_ros_api_tutorial.html#add-an-object-into-the-environment">Add an object into the environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../planning_scene_ros_api/planning_scene_ros_api_tutorial.html#interlude-synchronous-vs-asynchronous-updates">Interlude: Synchronous vs Asynchronous updates</a></li>
<li class="toctree-l3"><a class="reference internal" href="../planning_scene_ros_api/planning_scene_ros_api_tutorial.html#attach-an-object-to-the-robot">Attach an object to the robot</a></li>
<li class="toctree-l3"><a class="reference internal" href="../planning_scene_ros_api/planning_scene_ros_api_tutorial.html#detach-an-object-from-the-robot">Detach an object from the robot</a></li>
<li class="toctree-l3"><a class="reference internal" href="../planning_scene_ros_api/planning_scene_ros_api_tutorial.html#remove-the-object-from-the-collision-world">Remove the object from the collision world</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../moveit_cpp/moveitcpp_tutorial.html">MoveItCpp Tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../moveit_cpp/moveitcpp_tutorial.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../moveit_cpp/moveitcpp_tutorial.html#getting-started">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../moveit_cpp/moveitcpp_tutorial.html#running-the-code">Running the Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../moveit_cpp/moveitcpp_tutorial.html#the-entire-code">The Entire Code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../moveit_cpp/moveitcpp_tutorial.html#setup">Setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="../moveit_cpp/moveitcpp_tutorial.html#visualization">Visualization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../moveit_cpp/moveitcpp_tutorial.html#start-the-demo">Start the demo</a></li>
<li class="toctree-l3"><a class="reference internal" href="../moveit_cpp/moveitcpp_tutorial.html#planning-with-moveitcpp">Planning with MoveItCpp</a></li>
<li class="toctree-l3"><a class="reference internal" href="../moveit_cpp/moveitcpp_tutorial.html#plan-1">Plan #1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../moveit_cpp/moveitcpp_tutorial.html#plan-2">Plan #2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../moveit_cpp/moveitcpp_tutorial.html#plan-3">Plan #3</a></li>
<li class="toctree-l3"><a class="reference internal" href="../moveit_cpp/moveitcpp_tutorial.html#plan-4">Plan #4</a></li>
<li class="toctree-l3"><a class="reference internal" href="../moveit_cpp/moveitcpp_tutorial.html#plan-5">Plan #5</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../moveit_cpp/moveitcpp_tutorial.html#the-launch-file">The Launch File</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../urdf_srdf/urdf_srdf_tutorial.html">URDF and SRDF</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../urdf_srdf/urdf_srdf_tutorial.html#urdf">URDF</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../urdf_srdf/urdf_srdf_tutorial.html#urdf-resources">URDF Resources</a></li>
<li class="toctree-l3"><a class="reference internal" href="../urdf_srdf/urdf_srdf_tutorial.html#important-tips">Important Tips</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../urdf_srdf/urdf_srdf_tutorial.html#special-characters-in-joint-names">Special Characters in Joint Names</a></li>
<li class="toctree-l4"><a class="reference internal" href="../urdf_srdf/urdf_srdf_tutorial.html#safety-limits">Safety Limits</a></li>
<li class="toctree-l4"><a class="reference internal" href="../urdf_srdf/urdf_srdf_tutorial.html#collision-checking">Collision Checking</a></li>
<li class="toctree-l4"><a class="reference internal" href="../urdf_srdf/urdf_srdf_tutorial.html#test-your-urdf">Test your URDF</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../urdf_srdf/urdf_srdf_tutorial.html#urdf-examples">URDF Examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../urdf_srdf/urdf_srdf_tutorial.html#srdf">SRDF</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../urdf_srdf/urdf_srdf_tutorial.html#virtual-joints">Virtual Joints</a></li>
<li class="toctree-l3"><a class="reference internal" href="../urdf_srdf/urdf_srdf_tutorial.html#passive-joints">Passive Joints</a></li>
<li class="toctree-l3"><a class="reference internal" href="../urdf_srdf/urdf_srdf_tutorial.html#groups">Groups</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../urdf_srdf/urdf_srdf_tutorial.html#collection-of-joints">Collection of Joints</a></li>
<li class="toctree-l4"><a class="reference internal" href="../urdf_srdf/urdf_srdf_tutorial.html#collection-of-links">Collection of Links</a></li>
<li class="toctree-l4"><a class="reference internal" href="../urdf_srdf/urdf_srdf_tutorial.html#serial-chain">Serial Chain</a></li>
<li class="toctree-l4"><a class="reference internal" href="../urdf_srdf/urdf_srdf_tutorial.html#collection-of-sub-groups">Collection of Sub-Groups</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../urdf_srdf/urdf_srdf_tutorial.html#end-effectors">End-Effectors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../urdf_srdf/urdf_srdf_tutorial.html#self-collisions">Self-Collisions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../urdf_srdf/urdf_srdf_tutorial.html#robot-poses">Robot Poses</a></li>
<li class="toctree-l3"><a class="reference internal" href="../urdf_srdf/urdf_srdf_tutorial.html#srdf-documentation">SRDF Documentation</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../realtime_servo/realtime_servo_tutorial.html">Realtime Arm Servoing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../realtime_servo/realtime_servo_tutorial.html#getting-started">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../realtime_servo/realtime_servo_tutorial.html#launching-a-standalone-servo-node">Launching a Standalone Servo Node</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../realtime_servo/realtime_servo_tutorial.html#without-a-controller">Without a Controller</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../realtime_servo/realtime_servo_tutorial.html#expected-output">Expected Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="../realtime_servo/realtime_servo_tutorial.html#using-the-c-interface">Using the C++ Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../realtime_servo/realtime_servo_tutorial.html#id2">Expected Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="../realtime_servo/realtime_servo_tutorial.html#entire-code">Entire Code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../realtime_servo/realtime_servo_tutorial.html#setup">Setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="../realtime_servo/realtime_servo_tutorial.html#initializing-servo">Initializing Servo</a></li>
<li class="toctree-l3"><a class="reference internal" href="../realtime_servo/realtime_servo_tutorial.html#sending-commands">Sending Commands</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../realtime_servo/realtime_servo_tutorial.html#servo-overview">Servo Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../realtime_servo/realtime_servo_tutorial.html#setup-on-a-new-robot">Setup on a New Robot</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../realtime_servo/realtime_servo_tutorial.html#preliminaries">Preliminaries</a></li>
<li class="toctree-l3"><a class="reference internal" href="../realtime_servo/realtime_servo_tutorial.html#input-devices">Input Devices</a></li>
<li class="toctree-l3"><a class="reference internal" href="../realtime_servo/realtime_servo_tutorial.html#servo-configs">Servo Configs</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">moveit2_tutorials</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li class="wy-breadcrumbs-aside">
      
        
          <a href="https://github.com/ros-planning/moveit2_tutorials/blob/foxy/doc/planning_scene/planning_scene_tutorial.rst" class="fa fa-github"> Edit on GitHub</a>
        
      
    </li>
    <li><a href="http://moveit.ros.org">MoveIt</a> &raquo;</li>
    <li><a href="../../index.html">Tutorials</a> &raquo;</li>
      
    <li>Planning Scene</li>
  </ul>
  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             <!-- <div class="admonition note">  -->
               <!-- <p class="first admonition-title">Code Used in this Tutorial Available</p>  -->
               <!-- <p class="last">Code can be found at <a href = "https://github.com/ros-planning/moveit2_tutorials">moveit2_tutorials repository</a> in doc folder. Use master branch.</p> -->
             <!-- </div>  -->
            
  <div class="section" id="planning-scene">
<h1>Planning Scene<a class="headerlink" href="#planning-scene" title="Permalink to this headline">¶</a></h1>
<p>The <a class="reference external" href="https://github.com/ros-planning/moveit2/blob/foxy/moveit_core/planning_scene/include/moveit/planning_scene/planning_scene.h">PlanningScene</a> class provides the main interface that you will use
for collision checking and constraint checking. In this tutorial, we
will explore the C++ interface to this class.</p>
<div class="section" id="getting-started">
<h2>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h2>
<p>If you haven’t already done so, make sure you’ve completed the steps in <a class="reference external" href="../getting_started/getting_started.html">Getting Started</a>.</p>
</div>
<div class="section" id="the-entire-code">
<h2>The entire code<a class="headerlink" href="#the-entire-code" title="Permalink to this headline">¶</a></h2>
<p>The entire code can be seen <a class="reference external" href="https://github.com/ros-planning/moveit2_tutorials/blob/foxy/doc/planning_scene">here in the MoveIt GitHub project</a>.</p>
<div class="section" id="setup">
<h3>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="https://github.com/ros-planning/moveit2/blob/foxy/moveit_core/planning_scene/include/moveit/planning_scene/planning_scene.h">PlanningScene</a>
class can be easily setup and configured using a
<a class="reference external" href="https://github.com/ros-planning/moveit2/blob/foxy/moveit_core/robot_model/include/moveit/robot_model/robot_model.h">RobotModel</a>
or a URDF and SRDF. This is, however, not the recommended way to instantiate a
PlanningScene. The
<a class="reference external" href="https://github.com/ros-planning/moveit2/blob/foxy/moveit_ros/planning/planning_scene_monitor/include/moveit/planning_scene_monitor/planning_scene_monitor.h">PlanningSceneMonitor</a>
is the recommended method to create and maintain the current
planning scene (and is discussed in detail in the next tutorial)
using data from the robot’s joints and the sensors on the robot. In
this tutorial, we will instantiate a PlanningScene class directly,
but this method of instantiation is only intended for illustration.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">robot_model_loader</span><span class="o">::</span><span class="n">RobotModelLoader</span><span class="w"> </span><span class="nf">robot_model_loader</span><span class="p">(</span><span class="n">planning_scene_tutorial_node</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;robot_description&quot;</span><span class="p">);</span><span class="w"></span>
<span class="k">const</span><span class="w"> </span><span class="n">moveit</span><span class="o">::</span><span class="n">core</span><span class="o">::</span><span class="n">RobotModelPtr</span><span class="o">&amp;</span><span class="w"> </span><span class="n">kinematic_model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">robot_model_loader</span><span class="p">.</span><span class="n">getModel</span><span class="p">();</span><span class="w"></span>
<span class="n">planning_scene</span><span class="o">::</span><span class="n">PlanningScene</span><span class="w"> </span><span class="nf">planning_scene</span><span class="p">(</span><span class="n">kinematic_model</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="collision-checking">
<h3>Collision Checking<a class="headerlink" href="#collision-checking" title="Permalink to this headline">¶</a></h3>
<div class="section" id="self-collision-checking">
<h4>Self-collision checking<a class="headerlink" href="#self-collision-checking" title="Permalink to this headline">¶</a></h4>
<p>The first thing we will do is check whether the robot in its
current state is in <em>self-collision</em>, i.e. whether the current
configuration of the robot would result in the robot’s parts
hitting each other. To do this, we will construct a
<a class="reference external" href="https://github.com/ros-planning/moveit2/blob/foxy/moveit_core/collision_detection/include/moveit/collision_detection/collision_common.h">CollisionRequest</a>
object and a
<a class="reference external" href="https://github.com/ros-planning/moveit2/blob/foxy/moveit_core/collision_detection/include/moveit/collision_detection/collision_common.h">CollisionResult</a>
object and pass them
into the collision checking function. Note that the result of
whether the robot is in self-collision or not is contained within
the result. Self collision checking uses an <em>unpadded</em> version of
the robot, i.e. it directly uses the collision meshes provided in
the URDF with no extra padding added on.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">collision_detection</span><span class="o">::</span><span class="n">CollisionRequest</span><span class="w"> </span><span class="n">collision_request</span><span class="p">;</span><span class="w"></span>
<span class="n">collision_detection</span><span class="o">::</span><span class="n">CollisionResult</span><span class="w"> </span><span class="n">collision_result</span><span class="p">;</span><span class="w"></span>
<span class="n">planning_scene</span><span class="p">.</span><span class="n">checkSelfCollision</span><span class="p">(</span><span class="n">collision_request</span><span class="p">,</span><span class="w"> </span><span class="n">collision_result</span><span class="p">);</span><span class="w"></span>
<span class="n">RCLCPP_INFO_STREAM</span><span class="p">(</span><span class="n">LOGGER</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Test 1: Current state is &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">collision_result</span><span class="p">.</span><span class="n">collision</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s">&quot;in&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;not in&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">                                                       </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; self collision&quot;</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="change-the-state">
<h4>Change the state<a class="headerlink" href="#change-the-state" title="Permalink to this headline">¶</a></h4>
<p>Now, let’s change the current state of the robot. The planning
scene maintains the current state internally. We can get a
reference to it and change it and then check for collisions for the
new robot configuration. Note in particular that we need to clear
the collision_result before making a new collision checking
request.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">moveit</span><span class="o">::</span><span class="n">core</span><span class="o">::</span><span class="n">RobotState</span><span class="o">&amp;</span><span class="w"> </span><span class="n">current_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">planning_scene</span><span class="p">.</span><span class="n">getCurrentStateNonConst</span><span class="p">();</span><span class="w"></span>
<span class="n">current_state</span><span class="p">.</span><span class="n">setToRandomPositions</span><span class="p">();</span><span class="w"></span>
<span class="n">collision_result</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span><span class="w"></span>
<span class="n">planning_scene</span><span class="p">.</span><span class="n">checkSelfCollision</span><span class="p">(</span><span class="n">collision_request</span><span class="p">,</span><span class="w"> </span><span class="n">collision_result</span><span class="p">);</span><span class="w"></span>
<span class="n">RCLCPP_INFO_STREAM</span><span class="p">(</span><span class="n">LOGGER</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Test 2: Current state is &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">collision_result</span><span class="p">.</span><span class="n">collision</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s">&quot;in&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;not in&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">                                                       </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; self collision&quot;</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="checking-for-a-group">
<h4>Checking for a group<a class="headerlink" href="#checking-for-a-group" title="Permalink to this headline">¶</a></h4>
<p>Now, we will do collision checking only for the hand of the
Panda, i.e. we will check whether there are any collisions between
the hand and other parts of the body of the robot. We can ask
for this specifically by adding the group name “hand” to the
collision request.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">collision_request</span><span class="p">.</span><span class="n">group_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;hand&quot;</span><span class="p">;</span><span class="w"></span>
<span class="n">current_state</span><span class="p">.</span><span class="n">setToRandomPositions</span><span class="p">();</span><span class="w"></span>
<span class="n">collision_result</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span><span class="w"></span>
<span class="n">planning_scene</span><span class="p">.</span><span class="n">checkSelfCollision</span><span class="p">(</span><span class="n">collision_request</span><span class="p">,</span><span class="w"> </span><span class="n">collision_result</span><span class="p">);</span><span class="w"></span>
<span class="n">RCLCPP_INFO_STREAM</span><span class="p">(</span><span class="n">LOGGER</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Test 3: Current state is &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">collision_result</span><span class="p">.</span><span class="n">collision</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s">&quot;in&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;not in&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">                                                       </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; self collision&quot;</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="getting-contact-information">
<h4>Getting Contact Information<a class="headerlink" href="#getting-contact-information" title="Permalink to this headline">¶</a></h4>
<p>First, manually set the Panda arm to a position where we know
internal (self) collisions do happen. Note that this state is now
actually outside the joint limits of the Panda, which we can also
check for directly.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">joint_values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">-2.9</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.4</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
<span class="k">const</span><span class="w"> </span><span class="n">moveit</span><span class="o">::</span><span class="n">core</span><span class="o">::</span><span class="n">JointModelGroup</span><span class="o">*</span><span class="w"> </span><span class="n">joint_model_group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">current_state</span><span class="p">.</span><span class="n">getJointModelGroup</span><span class="p">(</span><span class="s">&quot;panda_arm&quot;</span><span class="p">);</span><span class="w"></span>
<span class="n">current_state</span><span class="p">.</span><span class="n">setJointGroupPositions</span><span class="p">(</span><span class="n">joint_model_group</span><span class="p">,</span><span class="w"> </span><span class="n">joint_values</span><span class="p">);</span><span class="w"></span>
<span class="n">RCLCPP_INFO_STREAM</span><span class="p">(</span><span class="n">LOGGER</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Test 4: Current state is &quot;</span><span class="w"></span>
<span class="w">                               </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">current_state</span><span class="p">.</span><span class="n">satisfiesBounds</span><span class="p">(</span><span class="n">joint_model_group</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s">&quot;valid&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;not valid&quot;</span><span class="p">));</span><span class="w"></span>
</pre></div>
</div>
<p>Now, we can get contact information for any collisions that might
have happened at a given configuration of the Panda arm. We can ask
for contact information by filling in the appropriate field in the
collision request and specifying the maximum number of contacts to
be returned as a large number.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">collision_request</span><span class="p">.</span><span class="n">contacts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>
<span class="n">collision_request</span><span class="p">.</span><span class="n">max_contacts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1000</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">collision_result</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span><span class="w"></span>
<span class="n">planning_scene</span><span class="p">.</span><span class="n">checkSelfCollision</span><span class="p">(</span><span class="n">collision_request</span><span class="p">,</span><span class="w"> </span><span class="n">collision_result</span><span class="p">);</span><span class="w"></span>
<span class="n">RCLCPP_INFO_STREAM</span><span class="p">(</span><span class="n">LOGGER</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Test 5: Current state is &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">collision_result</span><span class="p">.</span><span class="n">collision</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s">&quot;in&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;not in&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">                                                       </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; self collision&quot;</span><span class="p">);</span><span class="w"></span>
<span class="n">collision_detection</span><span class="o">::</span><span class="n">CollisionResult</span><span class="o">::</span><span class="n">ContactMap</span><span class="o">::</span><span class="n">const_iterator</span><span class="w"> </span><span class="n">it</span><span class="p">;</span><span class="w"></span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">it</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">collision_result</span><span class="p">.</span><span class="n">contacts</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">collision_result</span><span class="p">.</span><span class="n">contacts</span><span class="p">.</span><span class="n">end</span><span class="p">();</span><span class="w"> </span><span class="o">++</span><span class="n">it</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">RCLCPP_INFO</span><span class="p">(</span><span class="n">LOGGER</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Contact between: %s and %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">it</span><span class="o">-&gt;</span><span class="n">first</span><span class="p">.</span><span class="n">first</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span><span class="w"> </span><span class="n">it</span><span class="o">-&gt;</span><span class="n">first</span><span class="p">.</span><span class="n">second</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="modifying-the-allowed-collision-matrix">
<h4>Modifying the Allowed Collision Matrix<a class="headerlink" href="#modifying-the-allowed-collision-matrix" title="Permalink to this headline">¶</a></h4>
<p>The
<a class="reference external" href="https://github.com/ros-planning/moveit2/blob/foxy/moveit_core/collision_detection/include/moveit/collision_detection/collision_matrix.h">AllowedCollisionMatrix</a>
(ACM)
provides a mechanism to tell the collision world to ignore
collisions between certain object: both parts of the robot and
objects in the world. We can tell the collision checker to ignore
all collisions between the links reported above, i.e. even though
the links are actually in collision, the collision checker will
ignore those collisions and return not in collision for this
particular state of the robot.</p>
<p>Note also in this example how we are making copies of both the
allowed collision matrix and the current state and passing them in
to the collision checking function.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">collision_detection</span><span class="o">::</span><span class="n">AllowedCollisionMatrix</span><span class="w"> </span><span class="n">acm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">planning_scene</span><span class="p">.</span><span class="n">getAllowedCollisionMatrix</span><span class="p">();</span><span class="w"></span>
<span class="n">moveit</span><span class="o">::</span><span class="n">core</span><span class="o">::</span><span class="n">RobotState</span><span class="w"> </span><span class="n">copied_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">planning_scene</span><span class="p">.</span><span class="n">getCurrentState</span><span class="p">();</span><span class="w"></span>

<span class="n">collision_detection</span><span class="o">::</span><span class="n">CollisionResult</span><span class="o">::</span><span class="n">ContactMap</span><span class="o">::</span><span class="n">const_iterator</span><span class="w"> </span><span class="n">it2</span><span class="p">;</span><span class="w"></span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">it2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">collision_result</span><span class="p">.</span><span class="n">contacts</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span><span class="w"> </span><span class="n">it2</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">collision_result</span><span class="p">.</span><span class="n">contacts</span><span class="p">.</span><span class="n">end</span><span class="p">();</span><span class="w"> </span><span class="o">++</span><span class="n">it2</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">acm</span><span class="p">.</span><span class="n">setEntry</span><span class="p">(</span><span class="n">it2</span><span class="o">-&gt;</span><span class="n">first</span><span class="p">.</span><span class="n">first</span><span class="p">,</span><span class="w"> </span><span class="n">it2</span><span class="o">-&gt;</span><span class="n">first</span><span class="p">.</span><span class="n">second</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">collision_result</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span><span class="w"></span>
<span class="n">planning_scene</span><span class="p">.</span><span class="n">checkSelfCollision</span><span class="p">(</span><span class="n">collision_request</span><span class="p">,</span><span class="w"> </span><span class="n">collision_result</span><span class="p">,</span><span class="w"> </span><span class="n">copied_state</span><span class="p">,</span><span class="w"> </span><span class="n">acm</span><span class="p">);</span><span class="w"></span>
<span class="n">RCLCPP_INFO_STREAM</span><span class="p">(</span><span class="n">LOGGER</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Test 6: Current state is &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">collision_result</span><span class="p">.</span><span class="n">collision</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s">&quot;in&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;not in&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">                                                       </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; self collision&quot;</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="full-collision-checking">
<h4>Full Collision Checking<a class="headerlink" href="#full-collision-checking" title="Permalink to this headline">¶</a></h4>
<p>While we have been checking for self-collisions, we can use the
checkCollision functions instead which will check for both
self-collisions and for collisions with the environment (which is
currently empty).  This is the set of collision checking
functions that you will use most often in a planner. Note that
collision checks with the environment will use the padded version
of the robot. Padding helps in keeping the robot further away
from obstacles in the environment.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">collision_result</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span><span class="w"></span>
<span class="n">planning_scene</span><span class="p">.</span><span class="n">checkCollision</span><span class="p">(</span><span class="n">collision_request</span><span class="p">,</span><span class="w"> </span><span class="n">collision_result</span><span class="p">,</span><span class="w"> </span><span class="n">copied_state</span><span class="p">,</span><span class="w"> </span><span class="n">acm</span><span class="p">);</span><span class="w"></span>
<span class="n">RCLCPP_INFO_STREAM</span><span class="p">(</span><span class="n">LOGGER</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Test 7: Current state is &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">collision_result</span><span class="p">.</span><span class="n">collision</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s">&quot;in&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;not in&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">                                                       </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; self collision&quot;</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="constraint-checking">
<h3>Constraint Checking<a class="headerlink" href="#constraint-checking" title="Permalink to this headline">¶</a></h3>
<p>The PlanningScene class also includes easy to use function calls
for checking constraints. The constraints can be of two types:
(a) constraints chosen from the
<a class="reference external" href="https://github.com/ros-planning/moveit2/blob/foxy/moveit_core/kinematic_constraints/include/moveit/kinematic_constraints/kinematic_constraint.h">KinematicConstraint</a>
set: i.e. JointConstraint, PositionConstraint, OrientationConstraint and
VisibilityConstraint and (b) user
defined constraints specified through a callback. We will first
look at an example with a simple KinematicConstraint.</p>
<div class="section" id="checking-kinematic-constraints">
<h4>Checking Kinematic Constraints<a class="headerlink" href="#checking-kinematic-constraints" title="Permalink to this headline">¶</a></h4>
<p>We will first define a simple position and orientation constraint
on the end-effector of the panda_arm group of the Panda robot. Note the
use of convenience functions for filling up the constraints
(these functions are found in the
<a class="reference external" href="https://github.com/ros-planning/moveit2/blob/foxy/moveit_core/kinematic_constraints/include/moveit/kinematic_constraints/utils.h">utils.h</a>
file from the
kinematic_constraints directory in moveit_core).</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">end_effector_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">joint_model_group</span><span class="o">-&gt;</span><span class="n">getLinkModelNames</span><span class="p">().</span><span class="n">back</span><span class="p">();</span><span class="w"></span>

<span class="n">geometry_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">PoseStamped</span><span class="w"> </span><span class="n">desired_pose</span><span class="p">;</span><span class="w"></span>
<span class="n">desired_pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">orientation</span><span class="p">.</span><span class="n">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span><span class="w"></span>
<span class="n">desired_pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.3</span><span class="p">;</span><span class="w"></span>
<span class="n">desired_pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-0.185</span><span class="p">;</span><span class="w"></span>
<span class="n">desired_pose</span><span class="p">.</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="p">;</span><span class="w"></span>
<span class="n">desired_pose</span><span class="p">.</span><span class="n">header</span><span class="p">.</span><span class="n">frame_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;panda_link0&quot;</span><span class="p">;</span><span class="w"></span>
<span class="n">moveit_msgs</span><span class="o">::</span><span class="n">msg</span><span class="o">::</span><span class="n">Constraints</span><span class="w"> </span><span class="n">goal_constraint</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">    </span><span class="n">kinematic_constraints</span><span class="o">::</span><span class="n">constructGoalConstraints</span><span class="p">(</span><span class="n">end_effector_name</span><span class="p">,</span><span class="w"> </span><span class="n">desired_pose</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>Now, we can check a state against this constraint using the
isStateConstrained functions in the PlanningScene class.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">copied_state</span><span class="p">.</span><span class="n">setToRandomPositions</span><span class="p">();</span><span class="w"></span>
<span class="n">copied_state</span><span class="p">.</span><span class="n">update</span><span class="p">();</span><span class="w"></span>
<span class="kt">bool</span><span class="w"> </span><span class="n">constrained</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">planning_scene</span><span class="p">.</span><span class="n">isStateConstrained</span><span class="p">(</span><span class="n">copied_state</span><span class="p">,</span><span class="w"> </span><span class="n">goal_constraint</span><span class="p">);</span><span class="w"></span>
<span class="n">RCLCPP_INFO_STREAM</span><span class="p">(</span><span class="n">LOGGER</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Test 8: Random state is &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">constrained</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s">&quot;constrained&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;not constrained&quot;</span><span class="p">));</span><span class="w"></span>
</pre></div>
</div>
<p>There’s a more efficient way of checking constraints (when you want
to check the same constraint over and over again, e.g. inside a
planner). We first construct a KinematicConstraintSet which
pre-processes the ROS Constraints messages and sets it up for quick
processing.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">kinematic_constraints</span><span class="o">::</span><span class="n">KinematicConstraintSet</span><span class="w"> </span><span class="nf">kinematic_constraint_set</span><span class="p">(</span><span class="n">kinematic_model</span><span class="p">);</span><span class="w"></span>
<span class="n">kinematic_constraint_set</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">goal_constraint</span><span class="p">,</span><span class="w"> </span><span class="n">planning_scene</span><span class="p">.</span><span class="n">getTransforms</span><span class="p">());</span><span class="w"></span>
<span class="kt">bool</span><span class="w"> </span><span class="n">constrained_2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">planning_scene</span><span class="p">.</span><span class="n">isStateConstrained</span><span class="p">(</span><span class="n">copied_state</span><span class="p">,</span><span class="w"> </span><span class="n">kinematic_constraint_set</span><span class="p">);</span><span class="w"></span>
<span class="n">RCLCPP_INFO_STREAM</span><span class="p">(</span><span class="n">LOGGER</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Test 9: Random state is &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">constrained_2</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s">&quot;constrained&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;not constrained&quot;</span><span class="p">));</span><span class="w"></span>
</pre></div>
</div>
<p>There’s a direct way to do this using the KinematicConstraintSet
class.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">kinematic_constraints</span><span class="o">::</span><span class="n">ConstraintEvaluationResult</span><span class="w"> </span><span class="n">constraint_eval_result</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">    </span><span class="n">kinematic_constraint_set</span><span class="p">.</span><span class="n">decide</span><span class="p">(</span><span class="n">copied_state</span><span class="p">);</span><span class="w"></span>
<span class="n">RCLCPP_INFO_STREAM</span><span class="p">(</span><span class="n">LOGGER</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Test 10: Random state is &quot;</span><span class="w"></span>
<span class="w">                               </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">constraint_eval_result</span><span class="p">.</span><span class="n">satisfied</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s">&quot;constrained&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;not constrained&quot;</span><span class="p">));</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="user-defined-constraints">
<h4>User-defined constraints<a class="headerlink" href="#user-defined-constraints" title="Permalink to this headline">¶</a></h4>
<p>User defined constraints can also be specified to the PlanningScene
class. This is done by specifying a callback using the
setStateFeasibilityPredicate function. Here’s a simple example of a
user-defined callback that checks whether the “panda_joint1” of
the Panda robot is at a positive or negative angle:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">bool</span><span class="w"> </span><span class="nf">stateFeasibilityTestExample</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">moveit</span><span class="o">::</span><span class="n">core</span><span class="o">::</span><span class="n">RobotState</span><span class="o">&amp;</span><span class="w"> </span><span class="n">kinematic_state</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="cm">/*verbose*/</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="o">*</span><span class="w"> </span><span class="n">joint_values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kinematic_state</span><span class="p">.</span><span class="n">getJointPositions</span><span class="p">(</span><span class="s">&quot;panda_joint1&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">joint_values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>Now, whenever isStateFeasible is called, this user-defined callback
will be called.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">planning_scene</span><span class="p">.</span><span class="n">setStateFeasibilityPredicate</span><span class="p">(</span><span class="n">stateFeasibilityTestExample</span><span class="p">);</span><span class="w"></span>
<span class="kt">bool</span><span class="w"> </span><span class="n">state_feasible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">planning_scene</span><span class="p">.</span><span class="n">isStateFeasible</span><span class="p">(</span><span class="n">copied_state</span><span class="p">);</span><span class="w"></span>
<span class="n">RCLCPP_INFO_STREAM</span><span class="p">(</span><span class="n">LOGGER</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Test 11: Random state is &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">state_feasible</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s">&quot;feasible&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;not feasible&quot;</span><span class="p">));</span><span class="w"></span>
</pre></div>
</div>
<p>Whenever isStateValid is called, three checks are conducted: (a)
collision checking (b) constraint checking and (c) feasibility
checking using the user-defined callback.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">bool</span><span class="w"> </span><span class="n">state_valid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">planning_scene</span><span class="p">.</span><span class="n">isStateValid</span><span class="p">(</span><span class="n">copied_state</span><span class="p">,</span><span class="w"> </span><span class="n">kinematic_constraint_set</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;panda_arm&quot;</span><span class="p">);</span><span class="w"></span>
<span class="n">RCLCPP_INFO_STREAM</span><span class="p">(</span><span class="n">LOGGER</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Test 12: Random state is &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">state_valid</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s">&quot;valid&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;not valid&quot;</span><span class="p">));</span><span class="w"></span>
</pre></div>
</div>
<p>Note that all the planners available through MoveIt and OMPL will
currently perform collision checking, constraint checking and
feasibility checking using user-defined callbacks.</p>
</div>
</div>
</div>
<div class="section" id="the-launch-file">
<h2>The launch file<a class="headerlink" href="#the-launch-file" title="Permalink to this headline">¶</a></h2>
<p>The entire launch file is <a class="reference external" href="https://github.com/ros-planning/moveit2_tutorials/blob/foxy/doc/planning_scene/launch/planning_scene_tutorial.launch.py">here</a> on GitHub. All the code in this tutorial can be compiled and run from the moveit_tutorials package.</p>
</div>
<div class="section" id="running-the-code">
<h2>Running the code<a class="headerlink" href="#running-the-code" title="Permalink to this headline">¶</a></h2>
<p>Roslaunch the launch file to run the code directly from moveit_tutorials:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ros2</span> <span class="n">launch</span> <span class="n">moveit2_tutorials</span> <span class="n">planning_scene_tutorial</span><span class="o">.</span><span class="n">launch</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
</div>
<div class="section" id="expected-output">
<h2>Expected Output<a class="headerlink" href="#expected-output" title="Permalink to this headline">¶</a></h2>
<p>The output should look something like this, though we are using random
joint values so some things may be different.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">moveit2_tutorials</span><span class="p">:</span> <span class="n">Test</span> <span class="mi">1</span><span class="p">:</span> <span class="n">Current</span> <span class="n">state</span> <span class="ow">is</span> <span class="ow">in</span> <span class="bp">self</span> <span class="n">collision</span>
<span class="n">moveit2_tutorials</span><span class="p">:</span> <span class="n">Test</span> <span class="mi">2</span><span class="p">:</span> <span class="n">Current</span> <span class="n">state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span> <span class="n">collision</span>
<span class="n">moveit2_tutorials</span><span class="p">:</span> <span class="n">Test</span> <span class="mi">3</span><span class="p">:</span> <span class="n">Current</span> <span class="n">state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span> <span class="n">collision</span>
<span class="n">moveit2_tutorials</span><span class="p">:</span> <span class="n">Test</span> <span class="mi">4</span><span class="p">:</span> <span class="n">Current</span> <span class="n">state</span> <span class="ow">is</span> <span class="n">valid</span>
<span class="n">moveit2_tutorials</span><span class="p">:</span> <span class="n">Test</span> <span class="mi">5</span><span class="p">:</span> <span class="n">Current</span> <span class="n">state</span> <span class="ow">is</span> <span class="ow">in</span> <span class="bp">self</span> <span class="n">collision</span>
<span class="n">moveit2_tutorials</span><span class="p">:</span> <span class="n">Contact</span> <span class="n">between</span><span class="p">:</span> <span class="n">panda_leftfinger</span> <span class="ow">and</span> <span class="n">panda_link1</span>
<span class="n">moveit2_tutorials</span><span class="p">:</span> <span class="n">Contact</span> <span class="n">between</span><span class="p">:</span> <span class="n">panda_link1</span> <span class="ow">and</span> <span class="n">panda_rightfinger</span>
<span class="n">moveit2_tutorials</span><span class="p">:</span> <span class="n">Test</span> <span class="mi">6</span><span class="p">:</span> <span class="n">Current</span> <span class="n">state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span> <span class="n">collision</span>
<span class="n">moveit2_tutorials</span><span class="p">:</span> <span class="n">Test</span> <span class="mi">7</span><span class="p">:</span> <span class="n">Current</span> <span class="n">state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span> <span class="n">collision</span>
<span class="n">moveit2_tutorials</span><span class="p">:</span> <span class="n">Test</span> <span class="mi">8</span><span class="p">:</span> <span class="n">Random</span> <span class="n">state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">constrained</span>
<span class="n">moveit2_tutorials</span><span class="p">:</span> <span class="n">Test</span> <span class="mi">9</span><span class="p">:</span> <span class="n">Random</span> <span class="n">state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">constrained</span>
<span class="n">moveit2_tutorials</span><span class="p">:</span> <span class="n">Test</span> <span class="mi">10</span><span class="p">:</span> <span class="n">Random</span> <span class="n">state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">constrained</span>
<span class="n">moveit2_tutorials</span><span class="p">:</span> <span class="n">Test</span> <span class="mi">11</span><span class="p">:</span> <span class="n">Random</span> <span class="n">state</span> <span class="ow">is</span> <span class="n">feasible</span>
<span class="n">moveit2_tutorials</span><span class="p">:</span> <span class="n">Test</span> <span class="mi">12</span><span class="p">:</span> <span class="n">Random</span> <span class="n">state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">valid</span>
</pre></div>
</div>
</div>
</div>


            
            <div class="admonition note">
              <p class="first admonition-title">Open Source Feedback</p>
              <p class="last">See something that needs improvement? Please open a pull request on this <a href="https://github.com/ros-planning/moveit2_tutorials/blob/foxy/doc/planning_scene/planning_scene_tutorial.rst" class="fa fa-github"> GitHub page</a></p>
            </div>
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../planning_scene_monitor/planning_scene_monitor_tutorial.html" class="btn btn-neutral float-right" title="Planning Scene Monitor" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../robot_model_and_robot_state/robot_model_and_robot_state_tutorial.html" class="btn btn-neutral" title="Robot Model and Robot State" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>
        </div>
      </div>

    </section>
  </div>

  
    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'Foxy',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../_static/language_data.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>